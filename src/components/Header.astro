---
import Container from "@/components/Container.astro";
import Link from "@/components/Link.astro";
import { SITE } from "@/consts";
---

<header class="relative">
  <Container>
    <div class="flex flex-wrap gap-y-2 justify-between items-center py-4">
      <Link href="/" underline={false}>
        <div
          class="font-bold text-lg py-1 px-3 bg-neo-yellow dark:bg-neo-dark-blue border-2 border-black dark:border-white rotate-[-1deg] inline-block"
        >
          {SITE.NAME}
        </div>
      </Link>

      <button
        id="mobile-menu-button"
        aria-label="Toggle menu"
        class="md:hidden flex items-center justify-center bg-neo-yellow dark:bg-neo-dark-blue border-2 border-black dark:border-white p-2 shadow-neo dark:shadow-neo-light transition-all duration-200 hover:shadow-neo-hover hover:-translate-y-0.5 rotate-[0.5deg]"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="3"
          stroke-linecap="square"
          stroke-linejoin="miter"
          class="w-6 h-6"
        >
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      <nav id="nav-menu" class="hidden md:flex md:gap-4 w-full md:w-auto">
        <Link href="/" class_="nav-link">Home</Link>
        <span class="hidden md:inline font-bold">/</span>
        <Link href="/blog" class_="nav-link">Blog</Link>
        <span class="hidden md:inline font-bold">/</span>
        <Link href="/projects" class_="nav-link">Projects</Link>
        <span class="hidden md:inline font-bold">/</span>
        <Link href="/publications" class_="nav-link">Publications</Link>
        <span class="hidden md:inline font-bold">/</span>
        <a
          href="https://scholar.google.com/citations?user=PmVvceUAAAAJ&hl=fr"
          target="_blank"
          class="nav-link"
          aria-label="Google Scholar"
        >
          <span class="inline-flex items-center gap-1">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="inline-block"
            >
              <path
                d="M12 24a7 7 0 110-14 7 7 0 010 14zm0-24L0 9.5l4.838 3.94A8 8 0 0112 9a8 8 0 017.162 4.44L24 9.5z"
              ></path>
            </svg>
            <span>Scholar</span>
          </span>
        </a>
      </nav>
    </div>
  </Container>

  <!-- Mobile menu full-screen overlay -->
  <div
    id="mobile-nav-overlay"
    class="fixed inset-0 bg-neo-bglight dark:bg-neo-bgdark z-50 hidden"
  >
    <div class="h-full flex flex-col">
      <!-- Menu header -->
      <div
        class="flex justify-between items-center p-6 border-b-2 border-black dark:border-white"
      >
        <div class="font-bold text-2xl">Menu</div>
        <button
          id="mobile-menu-close"
          aria-label="Close menu"
          class="flex items-center justify-center bg-neo-pink dark:bg-neo-dark-pink border-2 border-black dark:border-white p-2 shadow-neo dark:shadow-neo-light hover:shadow-neo-hover hover:-translate-y-0.5 rotate-[-2deg] transition-all"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="3"
            stroke-linecap="square"
            class="w-6 h-6"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Menu links -->
      <nav class="flex-1 flex flex-col justify-center items-center gap-6 p-8">
        <a
          href="/"
          class="mobile-nav-link bg-neo-blue dark:bg-neo-dark-blue border-2 border-black dark:border-white shadow-neo dark:shadow-neo-light hover:shadow-neo-hover hover:-translate-y-1 transition-all duration-200 py-4 px-8 text-2xl font-bold rotate-[0.5deg]"
        >
          Home
        </a>
        <a
          href="/blog"
          class="mobile-nav-link bg-neo-yellow dark:bg-neo-dark-yellow border-2 border-black dark:border-white shadow-neo dark:shadow-neo-light hover:shadow-neo-hover hover:-translate-y-1 transition-all duration-200 py-4 px-8 text-2xl font-bold rotate-[-1deg]"
        >
          Blog
        </a>
        <a
          href="/projects"
          class="mobile-nav-link bg-neo-green dark:bg-neo-dark-green border-2 border-black dark:border-white shadow-neo dark:shadow-neo-light hover:shadow-neo-hover hover:-translate-y-1 transition-all duration-200 py-4 px-8 text-2xl font-bold rotate-[1deg]"
        >
          Projects
        </a>
        <a
          href="/publications"
          class="mobile-nav-link bg-neo-pink dark:bg-neo-dark-pink border-2 border-black dark:border-white shadow-neo dark:shadow-neo-light hover:shadow-neo-hover hover:-translate-y-1 transition-all duration-200 py-4 px-8 text-2xl font-bold rotate-[-0.5deg]"
        >
          Publications
        </a>
        <a
          href="https://scholar.google.com/citations?user=PmVvceUAAAAJ&hl=fr"
          target="_blank"
          class="mobile-nav-link bg-neo-blue dark:bg-neo-dark-blue border-2 border-black dark:border-white shadow-neo dark:shadow-neo-light hover:shadow-neo-hover hover:-translate-y-1 transition-all duration-200 py-4 px-8 text-2xl font-bold rotate-[0.75deg]"
        >
          <span class="inline-flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M12 24a7 7 0 110-14 7 7 0 010 14zm0-24L0 9.5l4.838 3.94A8 8 0 0112 9a8 8 0 017.162 4.44L24 9.5z"
              ></path>
            </svg>
            <span>Scholar</span>
          </span>
        </a>
      </nav>
    </div>
  </div>
</header>

<script>
  function setupMobileMenu() {
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenuClose = document.getElementById("mobile-menu-close");
    const mobileNavOverlay = document.getElementById("mobile-nav-overlay");
    let isMenuOpen = false;

    function toggleMobileMenu() {
      isMenuOpen = !isMenuOpen;

      if (isMenuOpen) {
        mobileNavOverlay?.classList.remove("hidden");
        setTimeout(() => {
          mobileNavOverlay?.classList.add("mobile-menu-open");
        }, 10);
        document.body.classList.add("overflow-hidden");
      } else {
        mobileNavOverlay?.classList.remove("mobile-menu-open");
        setTimeout(() => {
          mobileNavOverlay?.classList.add("hidden");
        }, 300);
        document.body.classList.remove("overflow-hidden");
      }
    }

    mobileMenuButton?.addEventListener("click", toggleMobileMenu);
    mobileMenuClose?.addEventListener("click", toggleMobileMenu);

    // Close menu when clicking on a mobile nav link
    document.querySelectorAll(".mobile-nav-link").forEach((link) => {
      link.addEventListener("click", () => {
        if (isMenuOpen) toggleMobileMenu();
      });
    });

    // Close menu on window resize if we go above mobile breakpoint
    window.addEventListener("resize", () => {
      if (window.innerWidth >= 768 && isMenuOpen) {
        isMenuOpen = false;
        mobileNavOverlay?.classList.add("hidden");
        mobileNavOverlay?.classList.remove("mobile-menu-open");
        document.body.classList.remove("overflow-hidden");
      }
    });
  }

  // Setup on initial load
  setupMobileMenu();

  // Reattach listeners on view transition navigation
  document.addEventListener("astro:before-preparation", () => {
    const mobileNavOverlay = document.getElementById("mobile-nav-overlay");
    mobileNavOverlay?.classList.add("hidden");
    mobileNavOverlay?.classList.remove("mobile-menu-open");
    document.body.classList.remove("overflow-hidden");
  });

  document.addEventListener("astro:after-swap", setupMobileMenu);
</script>

<style>
  #nav-menu {
    @apply flex-col md:flex-row;
    transition: all 0.3s ease-in-out;
  }

  #mobile-nav-overlay {
    opacity: 0;
    transform: scale(1.05);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #mobile-nav-overlay.mobile-menu-open {
    opacity: 1;
    transform: scale(1);
  }

  :global(.nav-link) {
    @apply font-bold border-b-2 border-black dark:border-white hover:bg-neo-yellow dark:hover:bg-neo-dark-blue transition-colors duration-200;
    transform: rotate(-0.5deg);
    display: inline-block;
  }

  .mobile-nav-link {
    @apply text-black dark:text-white;
    text-decoration: none;
    display: inline-block;
  }
</style>
